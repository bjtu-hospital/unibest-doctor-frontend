# 个人中心接口测试指南

## 🧪 测试步骤

### 1. 测试 Mock 数据

#### 步骤：
1. 打开 `src/service/profile.ts`
2. 设置 `USE_MOCK = true`
3. 保存文件，等待热更新
4. 进入个人中心页面

#### 预期结果：
```
本月出勤: 22 天
本月接诊: 156 人
累计接诊: 3240 人
```

---

### 2. 测试真实接口

#### 步骤：
1. 打开 `src/service/profile.ts`
2. 设置 `USE_MOCK = false`
3. 保存文件，等待热更新
4. 确保后端服务已启动
5. 进入个人中心页面

#### 预期行为：
- 页面加载时自动调用 `GET /doctor/profile/stats`
- 如果接口成功，显示真实统计数据
- 如果接口失败，显示 Toast 提示，统计数据为 0

---

### 3. 网络请求检查

#### Chrome DevTools:
1. F12 打开开发者工具
2. 切换到 **Network** 标签
3. 筛选 **Fetch/XHR**
4. 刷新个人中心页面
5. 查找 `profile/stats` 请求

#### 检查点：
- ✅ 请求 URL: `/doctor/profile/stats`
- ✅ 请求方法: `GET`
- ✅ 响应状态: `200 OK`
- ✅ 响应数据包含: `attendance`, `monthly_consult`, `total_consult`

---

### 4. 控制台日志

#### 正常情况：
```
无特殊日志（接口成功）
```

#### 失败情况：
```
Failed to fetch profile stats: [Error details]
Toast 提示: 加载统计数据失败
```

---

## 🔍 调试技巧

### 1. 查看请求参数
```typescript
// 在 src/service/profile.ts 的 getProfileStats 函数中添加：
console.log('Fetching profile stats...')
```

### 2. 查看响应数据
```typescript
// 在成功返回前添加：
console.log('Profile stats response:', res)
```

### 3. 模拟接口延迟
```typescript
// 在 Mock 分支中调整延迟时间
setTimeout(() => {
  resolve({ ...mockStats })
}, 3000) // 3秒延迟
```

---

## ✅ 验收标准

### 功能验收：
- [ ] Mock 数据能正确显示
- [ ] 真实接口能正常调用
- [ ] 接口失败时有错误提示
- [ ] 统计数据实时更新
- [ ] 用户信息正确显示
- [ ] 科室长徽章正确显示

### 性能验收：
- [ ] 页面加载时间 < 1 秒
- [ ] 接口响应时间 < 500ms
- [ ] 无内存泄漏
- [ ] 无重复请求

---

## 🐛 常见问题

### Q1: 统计数据一直显示 0
**原因**: 
- Mock 开关未正确设置
- 真实接口未响应
- 接口返回数据格式不匹配

**解决**:
1. 检查 `USE_MOCK` 值
2. 查看 Network 请求状态
3. 查看控制台错误日志

### Q2: 接口报 401 未授权
**原因**: Token 过期或未登录

**解决**:
1. 重新登录
2. 检查 `useTokenStore().hasLogin`
3. 查看 localStorage 中的 token

### Q3: 数据格式不匹配
**原因**: 后端返回字段名与前端不一致

**解决**:
```typescript
// service/profile.ts 已做兼容处理
monthlyConsult: res.monthly_consult || res.monthlyConsult || 0
```

---

## 📊 测试数据对照表

| 字段 | Mock 值 | 说明 |
|------|---------|------|
| attendance | 22 | 本月出勤天数 |
| monthlyConsult | 156 | 本月接诊人数 |
| totalConsult | 3240 | 累计接诊人数 |

---

## 🎯 下一步

测试通过后，可以：
1. 提交代码到 Git
2. 部署到测试环境
3. 进行 E2E 测试
4. 开发其他功能（修改密码、消息设置等）
