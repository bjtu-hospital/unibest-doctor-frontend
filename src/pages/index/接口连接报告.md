# 首页工作台接口连接报告

## ✅ 完成情况

### 1. Service 层实现
**文件**: `src/service/workbench.ts`

已实现接口：
- ✅ `getWorkbenchData()` - 获取工作台数据（包含医生信息、班次状态、今日数据、提醒、最近记录）
- ✅ `checkin()` - 签到
- ✅ `checkout()` - 签退
- ✅ `getShifts()` - 获取班次信息
- ✅ `getConsultationStats()` - 获取接诊统计
- ✅ `getRecentConsultations()` - 获取最近接诊记录

### 2. 页面集成
**文件**: `src/pages/index/index.vue`

已完成功能：
- ✅ 页面加载时自动获取工作台数据
- ✅ 显示医生个人信息卡片
- ✅ 签到/签退功能（支持定位）
- ✅ 今日排班显示
- ✅ 工作概览统计（待接诊、进行中、已完成）
- ✅ 待审批统计（科室长）
- ✅ 提醒事项板块
- ✅ 最近接诊记录板块
- ✅ 常用功能快捷入口

### 3. Mock 数据支持
**文件**: `src/pages/index/mock.ts`

已配置完整 Mock 数据，包括：
- ✅ 医生信息
- ✅ 班次状态
- ✅ 今日统计
- ✅ 提醒事项
- ✅ 最近接诊记录

---

## 🎯 API 接口映射

| 功能 | 前端方法 | 后端接口 | 状态 |
|------|----------|----------|------|
| 获取工作台数据 | `getWorkbenchData()` | `GET /doctor/workbench/dashboard` | ✅ 已实现 |
| 签到 | `checkin()` | `POST /doctor/workbench/checkin` | ✅ 已实现 |
| 签退 | `checkout()` | `POST /doctor/workbench/checkout` | ✅ 已实现 |
| 获取班次 | `getShifts()` | `GET /doctor/workbench/shifts` | ✅ 已实现 |
| 接诊统计 | `getConsultationStats()` | `GET /doctor/workbench/consultation-stats` | ✅ 已实现 |
| 最近接诊 | `getRecentConsultations()` | `GET /doctor/workbench/recent-consultations` | ✅ 已实现 |

---

## 📊 数据流程图

```
┌─────────────────────────────────────────────────┐
│          用户打开首页工作台                       │
└─────────────────┬───────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────┐
│       onMounted() 生命周期触发                    │
└─────────────────┬───────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────┐
│    并行加载: loadWorkbenchData() +               │
│              loadApprovalStats()                 │
└─────────────────┬───────────────────────────────┘
                  │
        ┌─────────┴─────────┐
        │                   │
        ▼                   ▼
┌──────────────┐    ┌──────────────┐
│ 工作台数据    │    │ 审批统计     │
│ (dashboard)  │    │ (仅科室长)   │
└──────┬───────┘    └──────┬───────┘
       │                   │
       └─────────┬─────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────┐
│         更新页面响应式数据                        │
│  - 签到签退状态                                  │
│  - 今日排班                                      │
│  - 接诊统计                                      │
│  - 提醒事项                                      │
│  - 最近接诊记录                                  │
└─────────────────┬───────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────┐
│         页面渲染所有模块                          │
└─────────────────────────────────────────────────┘
```

---

## 🔧 配置说明

### Mock 开关切换

**位置**: `src/service/workbench.ts` 第 9 行

```typescript
// 开发测试模式 - 使用 Mock 数据
const USE_MOCK = true

// 生产环境模式 - 使用真实接口
const USE_MOCK = false
```

---

## 📱 新增功能模块

### 1. 签到签退模块
- **位置**: 个人信息卡片下方
- **功能**: 
  - 显示当前班次信息
  - 支持点击签到（需要定位权限）
  - 签到后显示签到时间和签退按钮
  - 签退后显示工作时长
- **定位处理**: 
  - 优先获取真实定位
  - 定位失败时提示用户选择是否使用默认位置

### 2. 工作概览模块
- **位置**: 签到签退下方
- **功能**:
  - 显示今日排班（班次名称）
  - 显示待接诊人数（可点击跳转）
  - 显示待审批数量（仅科室长，可点击跳转）

### 3. 提醒事项模块
- **位置**: 常用功能下方
- **功能**:
  - 显示系统提醒
  - 显示请假审批提醒
  - 动态显示，无提醒时隐藏

### 4. 最近接诊记录模块
- **位置**: 提醒事项下方
- **功能**:
  - 显示最近3条接诊记录
  - 显示患者姓名、接诊时间、诊断
  - 可点击查看患者详情
  - 无记录时隐藏

---

## 🔍 接口详细说明

### 1. 获取工作台数据

**接口**: `GET /doctor/workbench/dashboard`

**返回数据结构**:
```typescript
{
  code: 0,
  message: {
    doctor: {...},           // 医生信息
    shiftStatus: {...},      // 班次状态
    todayData: {...},        // 今日统计
    reminders: [...],        // 提醒事项
    recentRecords: [...]     // 最近记录
  }
}
```

### 2. 签到

**接口**: `POST /doctor/workbench/checkin`

**请求参数**:
```typescript
{
  shiftId: number,      // 班次ID
  latitude: number,     // 纬度
  longitude: number     // 经度
}
```

**返回数据**:
```typescript
{
  code: 0,
  message: {
    checkinTime: string,     // 签到时间
    status: string,          // 状态
    message: string,         // 提示信息
    workDuration: string     // 工作时长
  }
}
```

### 3. 签退

**接口**: `POST /doctor/workbench/checkout`

**请求参数**: 同签到

**返回数据**:
```typescript
{
  code: 0,
  message: {
    checkoutTime: string,    // 签退时间
    workDuration: string,    // 工作时长
    status: string,          // 状态
    message: string          // 提示信息
  }
}
```

---

## 📝 使用示例

### 加载工作台数据
```typescript
import { getWorkbenchData } from '@/service/workbench'

const data = await getWorkbenchData()
console.log(data.shiftStatus)    // 班次状态
console.log(data.todayData)      // 今日统计
console.log(data.reminders)      // 提醒事项
console.log(data.recentRecords)  // 最近记录
```

### 签到
```typescript
import { checkin } from '@/service/workbench'

const result = await checkin({
  shiftId: 1,
  latitude: 39.9042,
  longitude: 116.4074
})
console.log(result.message)  // "签到成功"
```

### 签退
```typescript
import { checkout } from '@/service/workbench'

const result = await checkout({
  shiftId: 1,
  latitude: 39.9042,
  longitude: 116.4074
})
console.log(result.workDuration)  // "3小时47分钟"
```

---

## ⚠️ 注意事项

1. **定位权限**: 签到签退需要获取用户位置，请确保应用有定位权限
2. **时间限制**: 
   - 签到: 提前30分钟可签到
   - 签退: 班次结束后2小时内可签退
3. **班次验证**: 只能对当天的排班进行签到签退
4. **错误处理**: 所有接口调用都包含错误处理和用户提示
5. **数据刷新**: 签到签退成功后会自动重新加载工作台数据

---

## 🎉 总结

首页工作台接口连接已全部完成，实现了：
- ✅ 完整的 Service 层封装
- ✅ Mock 数据和真实接口自由切换
- ✅ 签到签退功能（支持定位）
- ✅ 实时数据展示
- ✅ 提醒事项和最近记录
- ✅ 错误处理和用户提示
- ✅ 类型安全（TypeScript）
- ✅ 响应式数据更新

可以开始进行测试和验收！
