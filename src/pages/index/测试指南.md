# 首页工作台测试指南

## 🧪 测试步骤

### 1. Mock 数据测试

#### 步骤：
1. 打开 `src/service/workbench.ts`
2. 设置 `USE_MOCK = true`
3. 保存文件，等待热更新
4. 刷新首页

#### 预期结果：
```
✓ 显示医生信息: 刘书旺 - 主任医师 - 心血管内科
✓ 签到签退状态: 今日尚未签到
✓ 今日排班: 上午门诊 08:00-12:00
✓ 待接诊: 10
✓ 提醒事项: 显示 1-2 条提醒
✓ 最近接诊: 显示 2-3 条记录
```

---

### 2. 真实接口测试

#### 步骤：
1. 打开 `src/service/workbench.ts`
2. 设置 `USE_MOCK = false`
3. 确保后端服务运行在 http://127.0.0.1:8000
4. 确保已登录（Token 有效）
5. 刷新首页

#### 预期行为：
- ✅ 页面加载时调用 `GET /doctor/workbench/dashboard`
- ✅ 显示真实医生信息和统计数据
- ✅ 如果接口失败，显示 Toast 提示

---

### 3. 签到功能测试

#### 步骤（Mock 模式）：
1. 确保 `USE_MOCK = true`
2. 点击"点击签到"按钮
3. 等待约800ms

#### 预期结果：
```
✓ 显示 Toast: "签到成功"
✓ 签到按钮消失
✓ 显示: "已签到 HH:mm"
✓ 显示签退按钮
```

#### 步骤（真实接口）：
1. 确保 `USE_MOCK = false`
2. 点击"点击签到"按钮
3. 浏览器会请求定位权限
4. 允许定位
5. 等待接口响应

#### 预期网络请求：
```
POST /doctor/workbench/checkin
Body: {
  shiftId: number,
  latitude: number,
  longitude: number
}
```

---

### 4. 签退功能测试

#### 前置条件：
- 已完成签到

#### 步骤：
1. 点击"点击签退"按钮
2. 等待接口响应

#### 预期结果：
```
✓ 显示 Toast: "签退成功\n工作时长: X小时X分钟"
✓ 签退按钮消失
✓ 签到状态重置
```

---

### 5. 定位失败测试

#### 步骤：
1. 在浏览器中拒绝定位权限
2. 点击签到按钮
3. 会弹出确认对话框

#### 预期行为：
- **选择确认**: 使用默认位置（北京坐标）继续签到
- **选择取消**: 取消签到操作

---

### 6. 交互测试

#### 测试点击跳转：
- [ ] 点击"待接诊"卡片 → 跳转到 `/pages/doctor/doctor`
- [ ] 点击"待审批"卡片 → 跳转到 `/pages/approval/index`
- [ ] 点击"开始接诊" → 跳转到 `/pages/doctor/doctor`
- [ ] 点击"请假申请" → 跳转到 `/pages/leave/index`
- [ ] 点击"审核请假" → 跳转到 `/pages/approval/index`
- [ ] 点击"调整排班" → 跳转到 `/pages/schedule/index`
- [ ] 点击最近接诊记录 → 跳转到患者详情页

---

## 🔍 网络请求检查

### Chrome DevTools:
1. F12 打开开发者工具
2. 切换到 **Network** 标签
3. 筛选 **Fetch/XHR**
4. 刷新首页

### 检查点：
- ✅ 请求 URL: `/doctor/workbench/dashboard`
- ✅ 请求方法: `GET`
- ✅ 响应状态: `200 OK`
- ✅ 响应数据包含: `doctor`, `shiftStatus`, `todayData`, `reminders`, `recentRecords`

### 签到请求检查：
- ✅ 请求 URL: `/doctor/workbench/checkin`
- ✅ 请求方法: `POST`
- ✅ 请求体包含: `shiftId`, `latitude`, `longitude`
- ✅ 响应数据包含: `checkinTime`, `status`, `message`

---

## 📊 控制台日志检查

### 正常情况：
```
无特殊日志（接口成功）
```

### 失败情况：
```
Failed to load workbench data: [Error details]
Toast 提示: 加载工作台数据失败
```

### 签到失败：
```
Check in failed: [Error details]
Toast 提示: 签到失败 / 定位不在允许范围内
```

---

## ✅ 验收标准

### 功能验收：
- [ ] Mock 数据能正确显示
- [ ] 真实接口能正常调用
- [ ] 签到功能正常
- [ ] 签退功能正常
- [ ] 定位功能正常
- [ ] 统计数据正确显示
- [ ] 提醒事项正确显示
- [ ] 最近记录正确显示
- [ ] 所有跳转链接正常
- [ ] 科室长特殊功能正常

### 性能验收：
- [ ] 页面加载时间 < 1 秒
- [ ] 接口响应时间 < 500ms
- [ ] 签到签退响应时间 < 1 秒
- [ ] 无内存泄漏
- [ ] 无重复请求

### UI/UX 验收：
- [ ] 签到签退按钮状态正确
- [ ] 加载时有状态提示
- [ ] 错误时有友好提示
- [ ] 定位失败有确认对话框
- [ ] 提醒和记录模块动态显示
- [ ] 点击效果流畅

---

## 🐛 常见问题排查

### Q1: 首页数据全部为 0
**原因**: 
- Mock 未开启且真实接口未响应
- Token 无效
- 后端服务未启动

**解决**:
1. 检查 `USE_MOCK` 设置
2. 查看 Network 请求状态
3. 检查 Token 是否有效
4. 确认后端服务运行

### Q2: 签到按钮无反应
**原因**:
- 今日无排班
- 定位权限未授予
- 网络请求失败

**解决**:
1. 查看控制台错误
2. 检查是否有 `currentShift` 数据
3. 检查浏览器定位权限

### Q3: 提醒和记录不显示
**原因**: 
- 这是正常行为，无数据时自动隐藏
- 后端返回空数组

**解决**:
1. 检查 `workbenchData.reminders` 是否有数据
2. 检查 `recentRecords` 是否有数据
3. 使用 Mock 数据测试

### Q4: 定位一直失败
**原因**:
- HTTPS 未启用（H5）
- 定位权限未授予
- 浏览器不支持定位API

**解决**:
1. 使用 localhost 或 HTTPS
2. 检查浏览器定位权限设置
3. 选择使用默认位置

---

## 📝 测试报告模板

```
测试日期: __________
测试人员: __________
测试环境: □ Mock  □ 真实接口

功能测试:
□ 工作台数据加载正常
□ 签到功能正常
□ 签退功能正常
□ 定位功能正常
□ 统计数据显示正常
□ 提醒事项显示正常
□ 最近记录显示正常
□ 跳转功能正常

性能测试:
页面加载时间: ______ ms
接口响应时间: ______ ms
签到响应时间: ______ ms

发现问题:
1. __________
2. __________

测试结论: □ 通过  □ 不通过

备注: __________
```

---

## 🎯 下一步

测试通过后：
1. 提交代码到 Git
2. 创建 Pull Request
3. Code Review
4. 合并到主分支
5. 部署到测试环境
6. 进行完整的 E2E 测试
