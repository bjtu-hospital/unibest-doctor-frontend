### 一、 核心流程概览



医生的操作主要分为四个阶段：

1. **初始化/监控**：查看待诊队列、当前状态。
2. **叫号**：呼叫下一位患者。
3. **诊疗中**：查看患者信息、进行诊断。
4. **结束当前诊疗**：分为“完成就诊”或“患者未到（过号）”。

------



### 二、 详细步骤与接口调用逻辑





#### 1. 界面初始化与队列监控



医生登录工作台或刷新页面时，需要获取当前的排班情况、候诊人数以及当前是否有人正在就诊。

- **业务场景**：医生打开“接诊工作台”页面。
- **调用接口**：`2.1 获取接诊队列`
  - **Method**: `GET /doctor/consultation/queue`
  - **关键参数**：`schedule_id` (排班ID)
- **前端处理逻辑**：
  - 解析 `stats` 渲染顶部统计数据（等待人数、已完成人数等）。
  - 检查 `currentPatient`：
    - 若**有值**（status=confirmed, isCall=true），说明属于“断线重连”或刷新页面，界面应直接显示“当前正在就诊：XXX”，并显示【完成就诊】和【过号】按钮。
    - 若**为 null**，说明当前空闲，界面应显示【叫下一位】按钮。
  - 渲染 `queue` (等待列表) 和 `completedQueue` (已完成列表)。



#### 2. 开始接诊（呼叫患者）



医生准备接待下一位患者。

- **业务场景**：当前诊室空闲，医生点击【叫号】/【下一位】按钮。
- **调用接口**：`2.2 叫下一个患者`
  - **Method**: `POST /doctor/consultation/next`
  - **关键参数**：`schedule_id`
- **前端处理逻辑**：
  - **成功 (Code 0)**：系统将队列中第一位移至当前就诊位。界面更新展示返回的 `nextPatient` 信息，按钮变更为【完成就诊】与【过号】。
  - **失败 (Code 301)**：提示“当前还有患者正在就诊”，阻止叫号，强制医生先处理当前患者。



#### 3. 诊疗过程（查看详情）



在诊疗过程中，医生可能需要查看患者的详细身份信息（如果列表信息不足）。

- **业务场景**：医生点击患者头像或需要核对患者详细年龄/性别。
- **调用接口**：`2.5 查询患者姓名` (详情)
  - **Method**: `GET /doctor/patient/{patient_id}`
  - **关键参数**：`patient_id`
- **前端处理逻辑**：弹窗或侧边栏显示患者详细信息（姓名、年龄、性别）。



#### 4. 结束当前诊疗（分支处理）



这里根据患者实际到场情况，分为两个分支：

**分支 A：患者正常就诊结束**

- **业务场景**：看病结束，医生点击【完成就诊】。
- **调用接口**：`2.4 完成患者就诊`
  - **Method**: `POST /doctor/consultation/complete`
  - **关键参数**：`order_id` (来自当前就诊患者的ID)
- **前端处理逻辑**：
  - 接口返回成功后，清空当前就诊区域。
  - 将该患者移动到“已完成队列”显示。
  - **下一步**：医生通常会紧接着再次点击【叫下一位】（回到流程第2步）。

**分支 B：患者未到场（过号）**

- **业务场景**：医生呼叫后，患者迟迟未进诊室，医生点击【过号】。
- **调用接口**：`2.3 患者过号（未到场）`
  - **Method**: `POST /doctor/consultation/pass`
  - **关键参数**：`order_id`, 可选 `max_pass_count`
- **前端处理逻辑**：
  - **注意**：根据接口说明，“过号后自动呼叫下一位”。
  - 接口返回数据中包含 `passedPatient` (刚才过号的人) 和 `nextPatient` (新呼叫的人)。
  - 界面需立刻更新：将刚过号的人移入过号或等待队列（取决于业务规则），并直接在“当前就诊区域”显示 `nextPatient` 的信息。
  - 此时不需要医生再次手动点击“叫下一位”。